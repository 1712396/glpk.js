#build glpk.js
mkdir .build
cd .build
emconfigure ../glpk-4.53/configure CFLAGS="-Wno-return-type"
# make fails but we use .o files
emmake make
ODIR="./src/.libs"

emcc -Oz -g0 $ODIR/libglpk_la-avl.o $ODIR/libglpk_la-bfd.o $ODIR/libglpk_la-bfx.o $ODIR/libglpk_la-glpapi01.o $ODIR/libglpk_la-glpapi02.o $ODIR/libglpk_la-glpapi03.o $ODIR/libglpk_la-glpapi04.o $ODIR/libglpk_la-glpapi05.o $ODIR/libglpk_la-glpapi06.o $ODIR/libglpk_la-glpapi07.o $ODIR/libglpk_la-glpapi08.o $ODIR/libglpk_la-glpapi09.o $ODIR/libglpk_la-glpapi10.o $ODIR/libglpk_la-glpapi11.o $ODIR/libglpk_la-glpapi12.o $ODIR/libglpk_la-glpapi13.o $ODIR/libglpk_la-glpapi14.o $ODIR/libglpk_la-glpapi15.o $ODIR/libglpk_la-glpapi16.o $ODIR/libglpk_la-glpapi17.o $ODIR/libglpk_la-glpapi18.o $ODIR/libglpk_la-glpapi19.o $ODIR/libglpk_la-glpapi20.o $ODIR/libglpk_la-glpapi21.o $ODIR/libglpk_la-glpcpx.o $ODIR/libglpk_la-glpdmx.o $ODIR/libglpk_la-glpgmp.o $ODIR/libglpk_la-glphbm.o $ODIR/libglpk_la-glpini01.o $ODIR/libglpk_la-glpini02.o $ODIR/libglpk_la-glpios01.o $ODIR/libglpk_la-glpios02.o $ODIR/libglpk_la-glpios03.o $ODIR/libglpk_la-glpios04.o $ODIR/libglpk_la-glpios05.o $ODIR/libglpk_la-glpios06.o $ODIR/libglpk_la-glpios07.o $ODIR/libglpk_la-glpios08.o $ODIR/libglpk_la-glpios09.o $ODIR/libglpk_la-glpios10.o $ODIR/libglpk_la-glpios11.o $ODIR/libglpk_la-glpios12.o $ODIR/libglpk_la-glpipm.o $ODIR/libglpk_la-glplpf.o $ODIR/libglpk_la-glpmat.o $ODIR/libglpk_la-glpmpl01.o $ODIR/libglpk_la-glpmpl02.o $ODIR/libglpk_la-glpmpl03.o $ODIR/libglpk_la-glpmpl04.o $ODIR/libglpk_la-glpmpl05.o $ODIR/libglpk_la-glpmpl06.o $ODIR/libglpk_la-glpmps.o $ODIR/libglpk_la-glpnet03.o $ODIR/libglpk_la-glpnet04.o $ODIR/libglpk_la-glpnet05.o $ODIR/libglpk_la-glpnpp01.o $ODIR/libglpk_la-glpnpp02.o $ODIR/libglpk_la-glpnpp03.o $ODIR/libglpk_la-glpnpp04.o $ODIR/libglpk_la-glpnpp05.o $ODIR/libglpk_la-glpnpp06.o $ODIR/libglpk_la-glprgr.o $ODIR/libglpk_la-glpscl.o $ODIR/libglpk_la-glpsdf.o $ODIR/libglpk_la-glpspm.o $ODIR/libglpk_la-glpspx01.o $ODIR/libglpk_la-glpspx02.o $ODIR/libglpk_la-glpsql.o $ODIR/libglpk_la-glpssx01.o $ODIR/libglpk_la-glpssx02.o $ODIR/libglpk_la-glptsp.o $ODIR/libglpk_la-lux.o $ODIR/libglpk_la-amd_1.o $ODIR/libglpk_la-amd_2.o $ODIR/libglpk_la-amd_aat.o $ODIR/libglpk_la-amd_control.o $ODIR/libglpk_la-amd_defaults.o $ODIR/libglpk_la-amd_dump.o $ODIR/libglpk_la-amd_info.o $ODIR/libglpk_la-amd_order.o $ODIR/libglpk_la-amd_post_tree.o $ODIR/libglpk_la-amd_postorder.o $ODIR/libglpk_la-amd_preprocess.o $ODIR/libglpk_la-amd_valid.o $ODIR/libglpk_la-fhv.o $ODIR/libglpk_la-fhvint.o $ODIR/libglpk_la-ifu.o $ODIR/libglpk_la-luf.o $ODIR/libglpk_la-lufint.o $ODIR/libglpk_la-sgf.o $ODIR/libglpk_la-sva.o $ODIR/libglpk_la-cfg.o $ODIR/libglpk_la-cfg1.o $ODIR/libglpk_la-colamd.o $ODIR/libglpk_la-alloc.o $ODIR/libglpk_la-dlsup.o $ODIR/libglpk_la-env.o $ODIR/libglpk_la-error.o $ODIR/libglpk_la-stdout.o $ODIR/libglpk_la-stream.o $ODIR/libglpk_la-time.o $ODIR/libglpk_la-tls.o $ODIR/libglpk_la-minisat.o $ODIR/libglpk_la-bignum.o $ODIR/libglpk_la-dmp.o $ODIR/libglpk_la-ffalg.o $ODIR/libglpk_la-fp2rat.o $ODIR/libglpk_la-gcd.o $ODIR/libglpk_la-jd.o $ODIR/libglpk_la-keller.o $ODIR/libglpk_la-mc13d.o $ODIR/libglpk_la-mc21a.o $ODIR/libglpk_la-okalg.o $ODIR/libglpk_la-qmd.o $ODIR/libglpk_la-relax4.o $ODIR/libglpk_la-rng.o $ODIR/libglpk_la-rng1.o $ODIR/libglpk_la-round2n.o $ODIR/libglpk_la-str2int.o $ODIR/libglpk_la-str2num.o $ODIR/libglpk_la-strspx.o $ODIR/libglpk_la-strtrim.o $ODIR/libglpk_la-triang.o $ODIR/libglpk_la-wclique.o $ODIR/libglpk_la-wclique1.o $ODIR/libglpk_la-proxy.o $ODIR/libglpk_la-proxy1.o $ODIR/libglpk_la-adler32.o $ODIR/libglpk_la-compress.o $ODIR/libglpk_la-crc32.o $ODIR/libglpk_la-deflate.o $ODIR/libglpk_la-gzclose.o $ODIR/libglpk_la-gzlib.o $ODIR/libglpk_la-gzread.o $ODIR/libglpk_la-gzwrite.o $ODIR/libglpk_la-inffast.o $ODIR/libglpk_la-inflate.o $ODIR/libglpk_la-inftrees.o $ODIR/libglpk_la-trees.o $ODIR/libglpk_la-uncompr.o $ODIR/libglpk_la-zio.o $ODIR/libglpk_la-zutil.o -o glpk.bc

# seems odd, but..: include cson to avoid messing around with emscripten api
emcc -Oz -g0 ../cson/cson_amalgamation_core.c -o cson.bc

EMCC_DEBUG=1 em++ --memory-init-file 0 -Oz -g0 -I../cson -I../glpk-4.53/src -I../glpk-4.53/src/env -I../glpk-4.53/src/misc ../glpk.js.c glpk.bc cson.bc -o glpk.js --pre-js ../pre.js --post-js ../post.js -s EXPORTED_FUNCTIONS="['_do_solve']" -s RESERVED_FUNCTION_POINTERS=20
